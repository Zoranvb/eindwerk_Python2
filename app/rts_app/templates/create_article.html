{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Input Article</title>
    
    <link rel="stylesheet" type="text/css" href="{% static 'css/create_article.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header>
        {% include 'rts_app/header.html' %}
    </header>

    <main class="container mt-4">
        <h2>Input Article</h2>

        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form.non_field_errors }}

            <!-- Product Type -->
            <div class="dropdown">
                <label for="id_producttype" class="form-label">Product Type</label>
                <select id="id_producttype" name="producttype" class="form-control">
                    <option value="">Select a product type</option>
                    {% for product in form.fields.producttype.queryset %}
                        <option value="{{ product.id }}" data-clothing="{{ product.clothing|yesno:'true,false' }}">{{ product.typename }}</option>
                    {% endfor %}
                </select>
                <span id="selected-producttype"></span>
            </div>

            <!-- Design -->
            <div class="dropdown">
                <label for="id_design" class="form-label">Design</label>
                {{ form.design }}
                <span id="selected-design"></span>
            </div>

            <!-- Company -->
            <div class="dropdown">
                <label for="id_companyname" class="form-label">Company</label>
                {{ form.companyname }}
                <span id="selected-companyname"></span>
            </div>

            <!-- Limited Edition Dropdown -->
            <div class="dropdown">
                <label for="id_limited_edition" class="form-label">Limited Edition</label>
                {{ form.limited_edition }}
                <span id="selected-limited-edition"></span>
            </div>

            <!-- Size Field (Hidden unless clothing) -->
            <div id="size-container" class="mb-3" style="display: none;">
                <label class="form-label">Sizes & Quantity</label>
                <div id="size-fields">
                    {% for size in form.sizes %}
                        <div class="d-flex align-items-center mb-2">
                            <button type="button" class="btn btn-outline-secondary btn-sm decrement" data-size="{{ size.sizenr }}">-</button>
                            <input type="number" name="size_{{ size.sizenr }}" value="0" min="0" class="form-control mx-2 size-input" style="width: 60px;">
                            <button type="button" class="btn btn-outline-secondary btn-sm increment" data-size="{{ size.sizenr }}">+</button>
                            <label class="ms-2">{{ size.size }}</label>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Non-clothing Quantity Field (Always visible, non-clothing) -->
            <div id="quantity-container" class="form-group mb-3">
                <label for="quantity" class="form-label">Quantity:</label>
                <input type="number" name="quantity" id="quantity" class="form-control" value="1" min="1" />
            </div>

            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </main>

    <footer>
        {% include 'rts_app/footer.html' %}
    </footer>

    <!-- jQuery Script -->
    <script>
        $(document).ready(function () {
            // Function to toggle size-container visibility based on product type
            function toggleSizeField() {
                var selectedOption = $("#id_producttype option:selected");
                var isClothing = selectedOption.data("clothing") === true;

                if (isClothing) {
                    $("#size-container").slideDown();   // Show size-container for clothing
                    $("#quantity-container").slideUp(); // Hide quantity for clothing
                } else {
                    $("#size-container").slideUp();     // Hide size-container for non-clothing
                    $("#quantity-container").slideDown();// Show quantity for non-clothing
                }

                // Display the selected option next to the dropdown
                $("#selected-producttype").text(selectedOption.text());
            }

            // Function to display selected option next to dropdown
            function displaySelectedOption(dropdownId, displayId) {
                var selectedOption = $(dropdownId + " option:selected").text();
                $(displayId).text(selectedOption);
            }

            // Initial check on page load
            toggleSizeField();
            displaySelectedOption("#id_design", "#selected-design");
            displaySelectedOption("#id_companyname", "#selected-companyname");
            displaySelectedOption("#id_limited_edition", "#selected-limited-edition");

            // On change of dropdowns
            $("#id_producttype").change(function () {
                toggleSizeField();
            });
            $("#id_design").change(function () {
                displaySelectedOption("#id_design", "#selected-design");
            });
            $("#id_companyname").change(function () {
                displaySelectedOption("#id_companyname", "#selected-companyname");
            });
            $("#id_limited_edition").change(function () {
                displaySelectedOption("#id_limited_edition", "#selected-limited-edition");
            });

            // Functionality for + and - buttons for size fields
            $(document).on("click", ".increment", function () {
                var input = $(this).siblings(".size-input");
                input.val(parseInt(input.val()) + 1);
            });

            $(document).on("click", ".decrement", function () {
                var input = $(this).siblings(".size-input");
                if (parseInt(input.val()) > 0) {
                    input.val(parseInt(input.val()) - 1);
                }
            });
        });
    </script>
</body>
</html>
